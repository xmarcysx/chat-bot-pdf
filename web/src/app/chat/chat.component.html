<div class="chat-app" [class.sidebar-closed]="!isSidebarOpen()">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SIDEBAR
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <aside class="sidebar" [class.open]="isSidebarOpen()">

    <!-- Sidebar header -->
    <div class="sidebar-header">
      <div class="brand">
        <span class="brand-icon">ü§ñ</span>
        <span class="brand-name">PDF Chat</span>
      </div>
      <button class="btn-icon" (click)="toggleSidebar()" title="Zwi≈Ñ panel">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
    </div>

    <!-- New chat button -->
    <button class="btn-new-chat" (click)="newConversation()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      Nowa rozmowa
    </button>

    <!-- Conversation list -->
    <div class="conversation-list">
      @if (conversations().length === 0) {
        <p class="no-conversations">Brak historii rozm√≥w</p>
      } @else {
        @for (conv of conversations(); track trackByConversation($index, conv)) {
          <div
            class="conversation-item"
            [class.active]="conv.id === activeConversationId()"
            (click)="selectConversation(conv.id)"
            (keydown.enter)="selectConversation(conv.id)"
            tabindex="0"
            role="button"
          >
            <svg class="conv-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            <span class="conv-title">{{ conv.title }}</span>
            <button
              class="btn-delete-conv"
              (click)="deleteConversation($event, conv.id)"
              title="Usu≈Ñ rozmowƒô"
            >
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        }
      }
    </div>

    <!-- Sidebar footer -->
    <div class="sidebar-footer">
      <div class="footer-badge">
        <span class="dot dot--green"></span>
        Powered by AI
      </div>
    </div>
  </aside>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MAIN AREA
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <main class="main">

    <!-- Top bar (visible when sidebar is closed) -->
    @if (!isSidebarOpen()) {
      <div class="topbar">
        <button class="btn-icon" (click)="toggleSidebar()" title="Otw√≥rz panel">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
        <span class="topbar-title">PDF Chat</span>
        <button class="btn-new-chat-top" (click)="newConversation()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
        </button>
      </div>
    }

    <!-- ‚îÄ‚îÄ Welcome screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    @if (!hasMessages()) {
      <div class="welcome">
        <div class="welcome-icon">ü§ñ</div>
        <h1 class="welcome-title">Jak mogƒô Ci pom√≥c?</h1>
        <p class="welcome-subtitle">
          Wy≈õlij wiadomo≈õƒá lub wybierz jeden z przyk≈Çad√≥w poni≈ºej
        </p>
        <div class="suggestions-grid">
          @for (s of suggestions; track s.text) {
            <button class="suggestion-card" (click)="useSuggestion(s.text)">
              <span class="suggestion-icon">{{ s.icon }}</span>
              <span>{{ s.text }}</span>
            </button>
          }
        </div>
      </div>
    }

    <!-- ‚îÄ‚îÄ Messages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    @if (hasMessages()) {
      <div class="messages-container" #messagesContainer>
        <div class="messages-inner">
          @for (msg of messages(); track trackByMessage($index, msg)) {

            <!-- User bubble -->
            @if (msg.role === 'user') {
              <div class="message message--user">
                <div class="message-bubble message-bubble--user">
                  <div class="message-content">{{ msg.content }}</div>
                  <span class="message-time">{{ formatTime(msg.timestamp) }}</span>
                </div>
                <div class="avatar avatar--user">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/>
                  </svg>
                </div>
              </div>
            }

            <!-- Assistant bubble -->
            @if (msg.role === 'assistant') {
              <div class="message message--assistant">
                <div class="avatar avatar--bot">ü§ñ</div>
                <div class="message-bubble message-bubble--assistant">
                  @if (msg.loading) {
                    <div class="typing-indicator">
                      <span></span><span></span><span></span>
                    </div>
                  } @else {
                    <div class="message-content" [innerHTML]="msg.content | messageFormat"></div>
                    <span class="message-time">{{ formatTime(msg.timestamp) }}</span>
                  }
                </div>
              </div>
            }

          }
        </div>
      </div>
    }

    <!-- ‚îÄ‚îÄ Input area ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="input-area">
      <div class="input-wrapper">
        <textarea
          #inputTextarea
          class="input-textarea"
          [value]="userInput()"
          (input)="onInputChange($any($event.target).value); autoResize($any($event.target))"
          (keydown)="onKeyDown($event)"
          placeholder="Napisz wiadomo≈õƒá‚Ä¶ (Enter = wy≈õlij, Shift+Enter = nowa linia)"
          rows="1"
          [disabled]="isTyping()"
        ></textarea>

        <button
          class="btn-send"
          (click)="sendMessage()"
          [disabled]="!userInput().trim() || isTyping()"
          [class.active]="userInput().trim() && !isTyping()"
          title="Wy≈õlij (Enter)"
        >
          @if (isTyping()) {
            <span class="spinner"></span>
          } @else {
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          }
        </button>
      </div>
      <p class="input-hint">PDF Chat mo≈ºe pope≈Çniaƒá b≈Çƒôdy. Zawsze weryfikuj wa≈ºne informacje.</p>
    </div>

  </main>
</div>
